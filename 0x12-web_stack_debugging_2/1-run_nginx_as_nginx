#!/usr/bin/env bash
# This script configures the container to run nginx as the nginx user and listen on port 8080

# Ensure nginx is installed
apt-get update && apt-get install -y nginx

# Create a new nginx configuration file
cat <<EOL > /etc/nginx/sites-available/default
server {
    listen 8080 default_server;
    listen [::]:8080 default_server;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;
    server_name _;
    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOL

# Update the nginx user
sed -i 's/user www-data;/user nginx;/g' /etc/nginx/nginx.conf

# Create the nginx user if it does not exist
id -u nginx &>/dev/null || useradd -r -d /var/www/html -s /bin/false nginx

# Set the correct permissions
chown -R nginx:nginx /var/www/html

# Start nginx
service nginx restart
